<!-- Componente de visualización de red de contactos -->
<div class="network-visualization" id="networkViz">
    <div class="network-center">
        <div class="contact-node central">
            {{ ciudadano.nombre|first }}{{ ciudadano.apellido|first }}
        </div>
        <h6 class="text-center mt-2">{{ ciudadano.nombre }} {{ ciudadano.apellido }}</h6>
    </div>
    
    <div class="network-connections" id="networkConnections">
        <!-- Las conexiones se generan dinámicamente -->
    </div>
</div>

<style>
.network-visualization {
    position: relative;
    min-height: 400px;
    background: radial-gradient(circle, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 2rem;
    overflow: hidden;
}

.network-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.network-connections {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.connection-node {
    position: absolute;
    cursor: pointer;
    transition: all 0.3s ease;
}

.connection-node:hover {
    transform: scale(1.1);
}

.connection-line {
    position: absolute;
    height: 2px;
    background: linear-gradient(90deg, transparent 0%, #007bff 20%, #007bff 80%, transparent 100%);
    transform-origin: left center;
    opacity: 0.6;
}

.connection-line.family {
    background: linear-gradient(90deg, transparent 0%, #28a745 20%, #28a745 80%, transparent 100%);
}

.connection-line.professional {
    background: linear-gradient(90deg, transparent 0%, #17a2b8 20%, #17a2b8 80%, transparent 100%);
}

.connection-line.emergency {
    background: linear-gradient(90deg, transparent 0%, #dc3545 20%, #dc3545 80%, transparent 100%);
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

.connection-line.active {
    animation: pulse 2s infinite;
}
</style>

<script>
function renderNetworkVisualization(vinculos, profesionales, emergencias) {
    const container = document.getElementById('networkConnections');
    const centerX = container.offsetWidth / 2;
    const centerY = container.offsetHeight / 2;
    const radius = Math.min(centerX, centerY) * 0.7;
    
    container.innerHTML = '';
    
    // Renderizar vínculos familiares
    vinculos.forEach((vinculo, index) => {
        const angle = (index / vinculos.length) * 2 * Math.PI;
        const x = centerX + Math.cos(angle) * radius;
        const y = centerY + Math.sin(angle) * radius;
        
        createConnectionNode(container, x, y, vinculo, 'family');
        createConnectionLine(container, centerX, centerY, x, y, 'family');
    });
    
    // Renderizar profesionales
    const profOffset = vinculos.length;
    profesionales.forEach((prof, index) => {
        const angle = ((index + profOffset) / (vinculos.length + profesionales.length)) * 2 * Math.PI;
        const x = centerX + Math.cos(angle) * (radius * 0.8);
        const y = centerY + Math.sin(angle) * (radius * 0.8);
        
        createConnectionNode(container, x, y, prof, 'professional');
        createConnectionLine(container, centerX, centerY, x, y, 'professional');
    });
    
    // Renderizar emergencias
    const emergOffset = vinculos.length + profesionales.length;
    emergencias.forEach((emerg, index) => {
        const angle = ((index + emergOffset) / (vinculos.length + profesionales.length + emergencias.length)) * 2 * Math.PI;
        const x = centerX + Math.cos(angle) * (radius * 1.1);
        const y = centerY + Math.sin(angle) * (radius * 1.1);
        
        createConnectionNode(container, x, y, emerg, 'emergency');
        createConnectionLine(container, centerX, centerY, x, y, 'emergency');
    });
}

function createConnectionNode(container, x, y, data, type) {
    const node = document.createElement('div');
    node.className = `connection-node`;
    node.style.left = `${x - 25}px`;
    node.style.top = `${y - 25}px`;
    
    let iniciales, nombre;
    if (type === 'family') {
        iniciales = `${data.ciudadano_vinculado.nombre[0]}${data.ciudadano_vinculado.apellido[0]}`;
        nombre = `${data.ciudadano_vinculado.nombre} ${data.ciudadano_vinculado.apellido}`;
    } else if (type === 'professional') {
        iniciales = data.usuario.nombre.split(' ').map(n => n[0]).join('');
        nombre = data.usuario.nombre;
    } else {
        iniciales = data.nombre.split(' ').map(n => n[0]).join('');
        nombre = data.nombre;
    }
    
    node.innerHTML = `
        <div class="contact-node ${type}" title="${nombre}">
            ${iniciales}
        </div>
    `;
    
    container.appendChild(node);
}

function createConnectionLine(container, x1, y1, x2, y2, type) {
    const line = document.createElement('div');
    line.className = `connection-line ${type}`;
    
    const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
    
    line.style.left = `${x1}px`;
    line.style.top = `${y1}px`;
    line.style.width = `${length}px`;
    line.style.transform = `rotate(${angle}deg)`;
    
    container.appendChild(line);
}
</script>